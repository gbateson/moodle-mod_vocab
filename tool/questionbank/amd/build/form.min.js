/**
 * mod/vocab/tool/questionbank/amd/src/form.js
 *
 * @module     vocabtool_questionbank
 * @copyright  2023 Gordon Bateson (gordon.bateson@gmail.com)
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      Moodle 3.11
 */
define("vocabtool_questionbank/form",["core/str"],(function(STR){let JS={str:{},add_event_listener:function(obj,evt,fn,useCapture){obj.addEventListener?obj.addEventListener(evt,fn,useCapture||!1):obj.attachEvent&&obj.attachEvent("on"+evt,fn)},init:function(){this.init_selectall_logs(),this.init_textareas_logs(),this.init_selectall_words(),this.init_checkboxes_words(),STR.get_strings([{key:"addname",component:"vocabtool_questionbank"},{key:"addtags",component:"vocabtool_questionbank"}]).done((function(s){var i=0;JS.str.addname=s[i++],JS.str.addtags=s[i++],JS.init_custom_names()}))},init_selectall_logs:function(){const selectall=document.querySelector('input[type="checkbox"][name="logids[selectall]"]');selectall&&(JS.add_event_listener(selectall,"click",JS.onclick_selectall),selectall.classList.contains("d-none")&&selectall.classList.remove("d-none"))},init_textareas_logs:function(){document.querySelectorAll("#id_log_error, #id_log_prompt, #id_log_results").forEach((function(textarea){JS.add_event_listener(textarea,"input",(function(){this.style.height="auto",this.style.height=this.scrollHeight+6+"px"})),textarea.dispatchEvent(new Event("input"))}))},init_selectall_words:function(){const selectall=document.querySelector('input[type="checkbox"][name="selectedwords[selectall]"]');if(selectall){JS.add_event_listener(selectall,"click",JS.onclick_selectall);const label=selectall.closest("label");if(label){label.classList.contains("d-none")&&label.classList.remove("d-none"),label.classList.add("btn","btn-light","border-dark"),label.classList.add("align-self-start","px-2","py-0");const p=label.closest(".fcontainer").querySelector(".col-form-label p");p&&p.replaceWith(label)}}},onclick_selectall:function(){const checked=this.checked,s='input[type="checkbox"][name^="'+this.name.substr(0,this.name.indexOf("["))+'"]';this.closest("fieldset").querySelectorAll(s).forEach((function(cb){cb.checked=checked}));let txt="";if(txt=checked?this.dataset.deselectall||"":this.dataset.selectall||"",txt){const label=this.closest("label");if(label){for(let i=label.childNodes.length-1;i>=0;i--){const n=label.childNodes[i];3==n.nodeType&&label.removeChild(n)}label.appendChild(document.createTextNode(txt))}}return!0},init_checkboxes_words:function(){document.querySelectorAll('input[type="checkbox"][name^="selectedwords"]').forEach((function(cb){JS.add_event_listener(cb,"click",JS.onclick_checkbox)}))},onclick_checkbox:function(evt){const felement=this.closest(".felement");if(null===felement)return!0;const dataclicked='input[type="checkbox"][data-clicked="1"]',cb_start=felement.querySelector(dataclicked),cb_stop=evt.currentTarget;let unclickall=!1,clickme=!0;if(evt.shiftKey)if(cb_start){let found=!1,startstop=!1;felement.querySelectorAll('input[type="checkbox"]').forEach((function(cb){startstop=cb==cb_start||cb==cb_stop,(found||startstop)&&(cb.checked=evt.currentTarget.checked,startstop&&(found=!found))})),unclickall=!0}else clickme=!0;else unclickall=!0,clickme=!0;unclickall&&felement.querySelectorAll(dataclicked).forEach((function(cb){cb.removeAttribute("data-clicked")})),clickme&&evt.currentTarget.setAttribute("data-clicked","1")},init_custom_names:function(){JS.init_custom_name("[name='subcat[name]']",".subcatnames","addname"),JS.init_custom_name("[name='qtag[name]']",".tagnames","addtags")},init_custom_name:function(sourceselector,targetselector,strname){let fitem=document.querySelector(sourceselector).closest(".fitem");document.querySelector("#questionbanklog_table").querySelectorAll(targetselector).forEach((function(ul){let names=[];if(ul.querySelectorAll("li").forEach((function(li){names.push(li.innerText)})),names.length){let separator=Object.assign(document.createElement("span"),{className:"w-100"}),div=Object.assign(document.createElement("div"),{className:"rounded border border-warning bg-light ml-4 my-1 pr-2 customnames"});div.appendChild(Object.assign(document.createElement("button"),{className:"btn btn-warning ml-0 py-1 px-2",onclick:JS.onclick_add_tags,textContent:JS.str[strname]})),div.appendChild(Object.assign(document.createElement("span"),{className:"ml-2",textContent:names.join(", ")})),fitem.parentNode.insertBefore(separator,fitem.nextSibling),separator.parentNode.insertBefore(div,separator.nextSibling)}}))},onclick_add_tags:function(evt){evt.preventDefault();let btn=evt.currentTarget,div=btn.closest(".customnames"),span=btn.nextElementSibling;if(div&&span){let inputfitem=JS.get_previous_sibling(div,".fitem");if(inputfitem){let input=inputfitem.querySelector("input[type='text']");if(input){input.value=span.textContent.trim();let checkboxfitem=JS.get_previous_sibling(inputfitem,".fitem");if(checkboxfitem){let checkbox=checkboxfitem.querySelector("input[type='checkbox']");checkbox&&(checkbox.checked=!0)}}}}return btn.blur(),!1},get_previous_sibling:function(elm,selector){selector||(selector="");let sibling=elm.previousElementSibling;for(;sibling;){if(""==selector||sibling.matches(selector))return sibling;sibling=sibling.previousElementSibling}return null}};return JS}));

//# sourceMappingURL=form.min.js.map