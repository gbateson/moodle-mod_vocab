{"version":3,"file":"form.min.js","sources":["../src/form.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * mod/vocab/tool/questionbank/amd/src/form.js\n *\n * @module     block_ungraded_activities\n * @copyright  2023 Gordon Bateson (gordon.bateson@gmail.com)\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since      Moodle 3.11\n */\n\ndefine([], function(){\n\n    let JS = {};\n    window.JS = JS;\n\n    JS.add_event_listener = function(obj, evt, fn, useCapture) {\n        if (obj.addEventListener) {\n            obj.addEventListener(evt, fn, (useCapture || false));\n        } else if (obj.attachEvent) {\n            obj.attachEvent('on' + evt, fn);\n        }\n    };\n\n    /*\n     * initialize this AMD module\n     */\n    JS.init = function() {\n        this.init_selectall();\n        this.init_checkboxes();\n    };\n\n    JS.init_selectall = function(){\n        const s = 'input[type=\"checkbox\"][name=\"selectedwords[selectall]\"]';\n        const selectall = document.querySelector(s);\n        if (selectall) {\n\n            JS.add_event_listener(selectall, 'click', JS.onclick_selectall);\n\n            const label = selectall.closest('label');\n            if (label) {\n                if (label.classList.contains('d-none')) {\n                    label.classList.remove('d-none');\n                }\n                label.classList.add('btn', 'btn-light', 'border-dark');\n                label.classList.add('align-self-start', 'px-2', 'py-0');\n\n                const p = label.closest('.fcontainer').querySelector('.col-form-label p');\n                if (p) {\n                    p.replaceWith(label);\n                }\n            }\n        }\n    };\n\n    JS.onclick_selectall = function(){\n        const checked = this.checked;\n\n        // Check/uncheck all other checkboxes in this fieldset\n        // that have the same name prefix, e.g. \"selectedwords\".\n        const nameprefix = this.name.substr(0, this.name.indexOf('['));\n        const s = 'input[type=\"checkbox\"][name^=\"' + nameprefix + '\"]';\n        this.closest('fieldset').querySelectorAll(s).forEach(function(cb){\n            cb.checked = checked;\n        });\n\n        // Set new text for this checkbox.\n        let txt = '';\n        if (checked) {\n            txt = this.dataset.deselectall || '';\n        } else {\n            txt = this.dataset.selectall || '';\n        }\n        if (txt) {\n            // Locate the label for this checkbox.\n            const label = this.closest('label');\n            if (label) {\n                // Remove existing text nodes in this label.\n                for (let i = (label.childNodes.length - 1); i >= 0 ; i--) {\n                    const n = label.childNodes[i];\n                    if (n.nodeType == 3) {\n                        label.removeChild(n);\n                    }\n                }\n                // Add new text in a node at the end of the label.\n                label.appendChild(document.createTextNode(txt));\n            }\n        }\n        return true;\n    };\n\n    JS.init_checkboxes = function(){\n        const s = 'input[type=\"checkbox\"][name^=\"selectedwords\"]';\n        document.querySelectorAll(s).forEach(function(cb){\n            JS.add_event_listener(cb, 'click', JS.onclick_checkbox);\n        });\n    };\n\n    JS.onclick_checkbox = function(evt){\n\n        const felement = this.closest('.felement');\n        if (felement === null) {\n            return true;\n        }\n\n        const checkboxes = 'input[type=\"checkbox\"]';\n        const dataclicked = checkboxes + '[data-clicked=\"1\"]';\n\n        const cb_start = felement.querySelector(dataclicked);\n        const cb_stop = evt.currentTarget;\n\n        let unclickall = false;\n        let clickme = true;\n\n        if (evt.shiftKey) {\n            if (cb_start) {\n                let found = false;\n                let startstop = false;\n                felement.querySelectorAll(checkboxes).forEach(function(cb){\n                    startstop = (cb == cb_start || cb == cb_stop);\n                    if (found || startstop) {\n                        cb.checked = evt.currentTarget.checked;\n                        if (startstop) {\n                            found = (found ? false : true);\n                        }\n                    }\n\n                });\n                unclickall = true;\n            } else {\n                clickme = true;\n            }\n        } else {\n            unclickall = true;\n            clickme = true;\n        }\n\n        if (unclickall) {\n            felement.querySelectorAll(dataclicked).forEach(function(cb){\n                cb.removeAttribute('data-clicked');\n            });\n        }\n\n        if (clickme) {\n            evt.currentTarget.setAttribute('data-clicked', '1');\n        }\n    };\n\n    return JS;\n});"],"names":["define","JS","window","add_event_listener","obj","evt","fn","useCapture","addEventListener","attachEvent","init","this","init_selectall","init_checkboxes","selectall","document","querySelector","onclick_selectall","label","closest","classList","contains","remove","add","p","replaceWith","checked","s","name","substr","indexOf","querySelectorAll","forEach","cb","txt","dataset","deselectall","i","childNodes","length","n","nodeType","removeChild","appendChild","createTextNode","onclick_checkbox","felement","dataclicked","checkboxes","cb_start","cb_stop","currentTarget","unclickall","clickme","shiftKey","found","startstop","removeAttribute","setAttribute"],"mappings":";;;;;;;;AAwBAA,qCAAO,IAAI,WAEP,IAAIC,GAAK,GAuIT,OAtIAC,OAAOD,GAAKA,GAEZA,GAAGE,mBAAqB,SAASC,IAAKC,IAAKC,GAAIC,YACvCH,IAAII,iBACJJ,IAAII,iBAAiBH,IAAKC,GAAKC,aAAc,GACtCH,IAAIK,aACXL,IAAIK,YAAY,KAAOJ,IAAKC,KAOpCL,GAAGS,KAAO,WACNC,KAAKC,iBACLD,KAAKE,mBAGTZ,GAAGW,eAAiB,WAChB,MACME,UAAYC,SAASC,cADjB,2DAEV,GAAIF,UAAW,CAEXb,GAAGE,mBAAmBW,UAAW,QAASb,GAAGgB,mBAE7C,MAAMC,MAAQJ,UAAUK,QAAQ,SAChC,GAAID,MAAO,CACHA,MAAME,UAAUC,SAAS,WACzBH,MAAME,UAAUE,OAAO,UAE3BJ,MAAME,UAAUG,IAAI,MAAO,YAAa,eACxCL,MAAME,UAAUG,IAAI,mBAAoB,OAAQ,QAEhD,MAAMC,EAAIN,MAAMC,QAAQ,eAAeH,cAAc,qBACjDQ,GACAA,EAAEC,YAAYP,UAM9BjB,GAAGgB,kBAAoB,WACnB,MAAMS,QAAUf,KAAKe,QAKfC,EAAI,iCADShB,KAAKiB,KAAKC,OAAO,EAAGlB,KAAKiB,KAAKE,QAAQ,MACC,KAC1DnB,KAAKQ,QAAQ,YAAYY,iBAAiBJ,GAAGK,SAAQ,SAASC,IAC1DA,GAAGP,QAAUA,WAIjB,IAAIQ,IAAM,GAMV,GAJIA,IADAR,QACMf,KAAKwB,QAAQC,aAAe,GAE5BzB,KAAKwB,QAAQrB,WAAa,GAEhCoB,IAAK,CAEL,MAAMhB,MAAQP,KAAKQ,QAAQ,SAC3B,GAAID,MAAO,CAEP,IAAK,IAAImB,EAAKnB,MAAMoB,WAAWC,OAAS,EAAIF,GAAK,EAAIA,IAAK,CACtD,MAAMG,EAAItB,MAAMoB,WAAWD,GACT,GAAdG,EAAEC,UACFvB,MAAMwB,YAAYF,GAI1BtB,MAAMyB,YAAY5B,SAAS6B,eAAeV,OAGlD,OAAO,GAGXjC,GAAGY,gBAAkB,WAEjBE,SAASgB,iBADC,iDACmBC,SAAQ,SAASC,IAC1ChC,GAAGE,mBAAmB8B,GAAI,QAAShC,GAAG4C,sBAI9C5C,GAAG4C,iBAAmB,SAASxC,KAE3B,MAAMyC,SAAWnC,KAAKQ,QAAQ,aAC9B,GAAiB,OAAb2B,SACA,OAAO,EAGX,MACMC,YAAcC,2CAEdC,SAAWH,SAAS9B,cAAc+B,aAClCG,QAAU7C,IAAI8C,cAEpB,IAAIC,YAAa,EACbC,SAAU,EAEd,GAAIhD,IAAIiD,SACJ,GAAIL,SAAU,CACV,IAAIM,OAAQ,EACRC,WAAY,EAChBV,SAASf,iBAbE,0BAa2BC,SAAQ,SAASC,IACnDuB,UAAavB,IAAMgB,UAAYhB,IAAMiB,SACjCK,OAASC,aACTvB,GAAGP,QAAUrB,IAAI8C,cAAczB,QAC3B8B,YACAD,OAASA,WAKrBH,YAAa,OAEbC,SAAU,OAGdD,YAAa,EACbC,SAAU,EAGVD,YACAN,SAASf,iBAAiBgB,aAAaf,SAAQ,SAASC,IACpDA,GAAGwB,gBAAgB,mBAIvBJ,SACAhD,IAAI8C,cAAcO,aAAa,eAAgB,MAIhDzD,EACX"}