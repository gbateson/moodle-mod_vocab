{"version":3,"file":"form.min.js","sources":["../src/form.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * mod/vocab/tool/questionbank/amd/src/form.js\n *\n * @module     vocabtool_questionbank\n * @copyright  2023 Gordon Bateson (gordon.bateson@gmail.com)\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since      Moodle 3.11\n */\n\ndefine([], function(){\n\n    let JS = {};\n\n    /*\n     * Add/Attach event listener (cross-browser version).\n     */\n    JS.add_event_listener = function(obj, evt, fn, useCapture) {\n        if (obj.addEventListener) {\n            obj.addEventListener(evt, fn, (useCapture || false));\n        } else if (obj.attachEvent) {\n            obj.attachEvent('on' + evt, fn);\n        }\n    };\n\n    /*\n     * Initialize this AMD module;\n     */\n    JS.init = function() {\n        this.init_selectall_logs();\n        this.init_selectall_words();\n        this.init_checkboxes_words();\n    };\n\n    JS.init_selectall_logs = function(){\n        const s = 'input[type=\"checkbox\"][name=\"logids[selectall]\"]';\n        const selectall = document.querySelector(s);\n        if (selectall) {\n            JS.add_event_listener(selectall, 'click', JS.onclick_selectall);\n            if (selectall.classList.contains(\"d-none\")) {\n                selectall.classList.remove(\"d-none\");\n            }\n        }\n    };\n\n    JS.init_selectall_words = function(){\n        const s = 'input[type=\"checkbox\"][name=\"selectedwords[selectall]\"]';\n        const selectall = document.querySelector(s);\n        if (selectall) {\n\n            JS.add_event_listener(selectall, 'click', JS.onclick_selectall);\n\n            const label = selectall.closest('label');\n            if (label) {\n                if (label.classList.contains('d-none')) {\n                    label.classList.remove('d-none');\n                }\n                label.classList.add('btn', 'btn-light', 'border-dark');\n                label.classList.add('align-self-start', 'px-2', 'py-0');\n\n                const p = label.closest('.fcontainer').querySelector('.col-form-label p');\n                if (p) {\n                    p.replaceWith(label);\n                }\n            }\n        }\n    };\n\n    JS.onclick_selectall = function(){\n        const checked = this.checked;\n\n        // Check/uncheck all other checkboxes in this fieldset\n        // that have the same name prefix, e.g. \"selectedwords\".\n        const nameprefix = this.name.substr(0, this.name.indexOf('['));\n        const s = 'input[type=\"checkbox\"][name^=\"' + nameprefix + '\"]';\n        this.closest('fieldset').querySelectorAll(s).forEach(function(cb){\n            cb.checked = checked;\n        });\n\n        // Set new text for this checkbox.\n        let txt = '';\n        if (checked) {\n            txt = this.dataset.deselectall || '';\n        } else {\n            txt = this.dataset.selectall || '';\n        }\n        if (txt) {\n            // Locate the label for this checkbox.\n            const label = this.closest('label');\n            if (label) {\n                // Remove existing text nodes in this label.\n                for (let i = (label.childNodes.length - 1); i >= 0 ; i--) {\n                    const n = label.childNodes[i];\n                    if (n.nodeType == 3) {\n                        label.removeChild(n);\n                    }\n                }\n                // Add new text in a node at the end of the label.\n                label.appendChild(document.createTextNode(txt));\n            }\n        }\n        return true;\n    };\n\n    JS.init_checkboxes_words = function(){\n        const s = 'input[type=\"checkbox\"][name^=\"selectedwords\"]';\n        document.querySelectorAll(s).forEach(function(cb){\n            JS.add_event_listener(cb, 'click', JS.onclick_checkbox);\n        });\n    };\n\n    JS.onclick_checkbox = function(evt){\n\n        const felement = this.closest('.felement');\n        if (felement === null) {\n            return true;\n        }\n\n        const checkboxes = 'input[type=\"checkbox\"]';\n        const dataclicked = checkboxes + '[data-clicked=\"1\"]';\n\n        const cb_start = felement.querySelector(dataclicked);\n        const cb_stop = evt.currentTarget;\n\n        let unclickall = false;\n        let clickme = true;\n\n        if (evt.shiftKey) {\n            if (cb_start) {\n                let found = false;\n                let startstop = false;\n                felement.querySelectorAll(checkboxes).forEach(function(cb){\n                    startstop = (cb == cb_start || cb == cb_stop);\n                    if (found || startstop) {\n                        cb.checked = evt.currentTarget.checked;\n                        if (startstop) {\n                            found = (found ? false : true);\n                        }\n                    }\n\n                });\n                unclickall = true;\n            } else {\n                clickme = true;\n            }\n        } else {\n            unclickall = true;\n            clickme = true;\n        }\n\n        if (unclickall) {\n            felement.querySelectorAll(dataclicked).forEach(function(cb){\n                cb.removeAttribute('data-clicked');\n            });\n        }\n\n        if (clickme) {\n            evt.currentTarget.setAttribute('data-clicked', '1');\n        }\n    };\n\n    return JS;\n});"],"names":["define","JS","obj","evt","fn","useCapture","addEventListener","attachEvent","init_selectall_logs","init_selectall_words","init_checkboxes_words","selectall","document","querySelector","add_event_listener","onclick_selectall","classList","contains","remove","label","closest","add","p","replaceWith","checked","this","s","name","substr","indexOf","querySelectorAll","forEach","cb","txt","dataset","deselectall","i","childNodes","length","n","nodeType","removeChild","appendChild","createTextNode","onclick_checkbox","felement","dataclicked","checkboxes","cb_start","cb_stop","currentTarget","unclickall","clickme","shiftKey","found","startstop","removeAttribute","setAttribute"],"mappings":";;;;;;;;AAwBAA,qCAAO,IAAI,eAEHC,GAAK,CAKTA,mBAAwB,SAASC,IAAKC,IAAKC,GAAIC,YACvCH,IAAII,iBACJJ,IAAII,iBAAiBH,IAAKC,GAAKC,aAAc,GACtCH,IAAIK,aACXL,IAAIK,YAAY,KAAOJ,IAAKC,KAOpCH,KAAU,gBACDO,2BACAC,4BACAC,yBAGTT,oBAAyB,iBAEfU,UAAYC,SAASC,cADjB,oDAENF,YACAV,GAAGa,mBAAmBH,UAAW,QAASV,GAAGc,mBACzCJ,UAAUK,UAAUC,SAAS,WAC7BN,UAAUK,UAAUE,OAAO,YAKvCjB,qBAA0B,iBAEhBU,UAAYC,SAASC,cADjB,8DAENF,UAAW,CAEXV,GAAGa,mBAAmBH,UAAW,QAASV,GAAGc,yBAEvCI,MAAQR,UAAUS,QAAQ,YAC5BD,MAAO,CACHA,MAAMH,UAAUC,SAAS,WACzBE,MAAMH,UAAUE,OAAO,UAE3BC,MAAMH,UAAUK,IAAI,MAAO,YAAa,eACxCF,MAAMH,UAAUK,IAAI,mBAAoB,OAAQ,cAE1CC,EAAIH,MAAMC,QAAQ,eAAeP,cAAc,qBACjDS,GACAA,EAAEC,YAAYJ,UAM9BlB,kBAAuB,iBACbuB,QAAUC,KAAKD,QAKfE,EAAI,iCADSD,KAAKE,KAAKC,OAAO,EAAGH,KAAKE,KAAKE,QAAQ,MACC,UACrDT,QAAQ,YAAYU,iBAAiBJ,GAAGK,SAAQ,SAASC,IAC1DA,GAAGR,QAAUA,eAIbS,IAAM,MAENA,IADAT,QACMC,KAAKS,QAAQC,aAAe,GAE5BV,KAAKS,QAAQvB,WAAa,GAEhCsB,IAAK,OAECd,MAAQM,KAAKL,QAAQ,YACvBD,MAAO,KAEF,IAAIiB,EAAKjB,MAAMkB,WAAWC,OAAS,EAAIF,GAAK,EAAIA,IAAK,OAChDG,EAAIpB,MAAMkB,WAAWD,GACT,GAAdG,EAAEC,UACFrB,MAAMsB,YAAYF,GAI1BpB,MAAMuB,YAAY9B,SAAS+B,eAAeV,cAG3C,GAGXhC,sBAA2B,WAEvBW,SAASkB,iBADC,iDACmBC,SAAQ,SAASC,IAC1C/B,GAAGa,mBAAmBkB,GAAI,QAAS/B,GAAG2C,sBAI9C3C,iBAAsB,SAASE,WAErB0C,SAAWpB,KAAKL,QAAQ,gBACb,OAAbyB,gBACO,QAILC,YAAcC,2CAEdC,SAAWH,SAAShC,cAAciC,aAClCG,QAAU9C,IAAI+C,kBAEhBC,YAAa,EACbC,SAAU,KAEVjD,IAAIkD,YACAL,SAAU,KACNM,OAAQ,EACRC,WAAY,EAChBV,SAASf,iBAbE,0BAa2BC,SAAQ,SAASC,IACnDuB,UAAavB,IAAMgB,UAAYhB,IAAMiB,SACjCK,OAASC,aACTvB,GAAGR,QAAUrB,IAAI+C,cAAc1B,QAC3B+B,YACAD,OAASA,WAKrBH,YAAa,OAEbC,SAAU,OAGdD,YAAa,EACbC,SAAU,EAGVD,YACAN,SAASf,iBAAiBgB,aAAaf,SAAQ,SAASC,IACpDA,GAAGwB,gBAAgB,mBAIvBJ,SACAjD,IAAI+C,cAAcO,aAAa,eAAgB,cAIhDxD"}